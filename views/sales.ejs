<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Sales Page</title>
</head>

<body>
  <h1>Sales</h1>

  [ <a href="employees">Employees</a> | <a href="customers">Customers</a> | <a href="sales">Sales</a> |
  <a href="salehas_clothes">Sale Has Clothes</a> | <a href="clothes">Clothes</a> | <a href="manufacturers">Manufacturers</a> | <a href="/">Index</a> ]

  <div id="browse">
    <p> </p>
    <table border="1" cellpadding="5">
      <tr>
        <th>SaleID</th>
        <th>Discount Percent</th>
        <th>payment</th>
        <th>date</th>
        <th>Customer</th>
        <th>Employee</th>
      </tr>
      <!-- Table data fields loading in most current db records from server -->
      <%records.forEach(record=> {%>
        <tr>
          <td><%=record['idSale']%></td>
          <td><%=record['discountPercent']%></td>
          <td><%=record['payment']%></td>
          <td><%=record['date']%></td>
          <td><%=record['Customers_idCustomer']%></td>
          <td><%=record['Employees_idEmployee']%></td>
        </tr>
        <%});%>
    </table>
  </div>

  <p>&nbsp;</p>
  <div id="insert">
    <form method="POST" action="/sales/create" id="addSale">
      <legend><strong>Add sale</strong></legend>
      <fieldset class="fields">
        <label> discount percent </label> <input type="text" name="discountPercent">
        <label> payment </label> <input type="text" name="payment">
        <label> date/time </label> <input type="datetime-local" name="date">
        <label> customer </label> <select name="Customers_idCustomer">
          <option value="0">&nbsp;</option>
          <option value="1">Ben Gulbranson</option>
          <option value="2">Parsa Fallah</option>
          <option value="3">Jade Carey</option>
        </select>
        <label> employee </label> <select name="Employees_idEmployees">
          <option value="0">&nbsp;</option>
          <option value="1">Alexander Addis</option>
          <option value="2">Duncan Everson</option>
          <option value="3">Benny Beaver</option>
          <option value="4">N/A</option>
        </select>
      </fieldset>
      <input class="btn" type="submit" id="addSale" value="Add sale">
    </form>
  </div>

  <p>&nbsp;</p>
  <div id="update">
    <form method="POST" action="/sales/update" id="updateSale">
      <legend><strong>Add sale</strong></legend>
      <fieldset class="fields">
        <label> ID to update </label> <select name="ID">
          <option value="0">&nbsp;</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>
        <label> discount percent </label> <input type="text" name="discountPercent">
        <label> payment </label> <input type="text" name="payment">
        <label> date/time </label> <input type="datetime-local" name="date">
        <label> customer </label> <select name="Customers_idCustomer">
          <option value="0">&nbsp;</option>
          <option value="1">Ben Gulbranson</option>
          <option value="2">Parsa Fallah</option>
          <option value="3">Jade Carey</option>
        </select>
        <label> employee </label> <select name="Employees_idEmployees">
          <option value="0">&nbsp;</option>
          <option value="1">Alexander Addis</option>
          <option value="2">Duncan Everson</option>
          <option value="3">Benny Beaver</option>
          <option value="4">N/A</option>
        </select>
      </fieldset>
      <input class="btn" type="submit" id="updateSale" value="Update sale">
    </form>
  </div>

  <!-- Make the update form auto-populate with record info based on the id -->
  <script>
    const records = <%- JSON.stringify(records) %>; // Pass server-side records to client-side JS

    // Event listener for dropdown change
    document.getElementById('salesSelect').addEventListener('change', function() {
      const selectedId = this.value;
      const inputs = {
        discountPercent: document.getElementById('discountPercent'),
        payment: document.getElementById('payment'),
        date: document.getElementById('date'),
        Customers_idCustomer: document.getElementById('Customers_idCustomer'),
        Employees_idEmployees: document.getElementById('Employees_idEmployees'),
      };

      // Reset inputs if "0" is selected
      if (selectedId === "0") {
        inputs.discountPercent.value = '';
        inputs.payment.value = '';
        inputs.date.value = '';
        inputs.Customers_idCustomer.value = '';
        inputs.Employees_idEmployee.value = '';
        return;
      }

      // Find the selected record
      const record = records.find(r => r.idSale == selectedId);
      if (record) {

        // confirmed it has all of the correct information. Why does it fail?
        inputs.discountPercent.value = record['discountPercent'] || '';
        inputs.payment.value = record['payment'] || '';
        inputs.date.value = record['date'] || '';
        inputs.Customers_idCustomer.value = record['price'] || '';
        inputs.Employees_idEmployee.value = record['Purchase Cost'] || '';
      }
    });
  </script>

  <p>&nbsp;</p>
  <div id="delete" style="display: block">
    <form method="POST" action="/sales/delete" id="deleteSale">
      <legend><strong>Delete sale</strong></legend>
      <fieldset class="fields">
        <label> ID </label> <select name="ID">
          <option value="0">&nbsp;</option>
          <%records.forEach(record=> {%>
            <option value="<%=record.idSale%>"><%=record.idSale%></option>
            <%});%>
        </select>
      </fieldset>
      <input class="btn" type="submit" id="DeleteSale" value="Delete Sale">
    </form>
  </div>
</body>

</html>